{% extends "base.html" %}
{% load static %}

{% block title %}Multi-Phase Retirement Calculator{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-12">
    <div class="container mx-auto px-4">
        {# Header #}
        <div class="text-center mb-8">
            <div class="flex justify-center items-center gap-4 mb-4">
                <h1 class="text-5xl font-bold text-gray-800">
                    Multi-Phase Retirement Calculator
                </h1>
            </div>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto mb-4">
                Plan your entire retirement journey across all four critical phases
            </p>
            <a href="{% url 'calculator:multi_phase_calculator' %}"
               class="inline-block bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition">
                Clear All
            </a>
        </div>

        {# Loaded Scenario Message #}
        {% if loaded_scenario %}
        <div class="max-w-4xl mx-auto mb-8">
            <div class="bg-green-100 border border-green-400 text-green-700 px-6 py-4 rounded-lg flex items-center justify-between">
                <div>
                    <span class="font-semibold">âœ“ Scenario Loaded:</span> {{ loaded_scenario.name }}
                </div>
                <a href="{% url 'calculator:multi_phase_calculator' %}"
                   class="text-green-800 hover:text-green-900 underline">
                    Clear & Start New
                </a>
            </div>
        </div>
        {% endif %}

        {# Tab Navigation #}
        <div class="bg-white rounded-t-xl shadow-lg border-b-2 border-gray-200">
            <div class="flex overflow-x-auto">
                <button
                    onclick="switchTab('accumulation')"
                    id="tab-accumulation"
                    class="tab-button flex-1 px-6 py-4 text-center font-semibold border-b-4 border-blue-500 bg-blue-50 text-blue-700 transition-all hover:bg-blue-100">
                    <div class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                        Phase 1: Accumulation
                    </div>
                    <div class="text-xs mt-1 text-blue-600">Building Wealth</div>
                </button>

                <button
                    onclick="switchTab('phased-retirement')"
                    id="tab-phased-retirement"
                    class="tab-button flex-1 px-6 py-4 text-center font-semibold border-b-4 border-transparent text-gray-600 transition-all hover:bg-gray-50">
                    <div class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Phase 2: Phased
                    </div>
                    <div class="text-xs mt-1">Semi-Retirement <span class="opacity-60">(Optional)</span></div>
                </button>

                <button
                    onclick="switchTab('active-retirement')"
                    id="tab-active-retirement"
                    class="tab-button flex-1 px-6 py-4 text-center font-semibold border-b-4 border-transparent text-gray-600 transition-all hover:bg-gray-50">
                    <div class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Phase 3: Active
                    </div>
                    <div class="text-xs mt-1">Early Retirement</div>
                </button>

                <button
                    onclick="switchTab('late-retirement')"
                    id="tab-late-retirement"
                    class="tab-button flex-1 px-6 py-4 text-center font-semibold border-b-4 border-transparent text-gray-600 transition-all hover:bg-gray-50">
                    <div class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        Phase 4: Late
                    </div>
                    <div class="text-xs mt-1">Legacy Planning</div>
                </button>
            </div>
        </div>

        {# Tab Content #}
        <div class="bg-white rounded-b-xl shadow-lg p-8">
            {# Phase 1: Accumulation #}
            <div id="content-accumulation" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {# Form Column #}
                    <div>
                        <h2 class="text-2xl font-bold text-blue-900 mb-4">Phase 1: Accumulation</h2>

                        {# Collapsible Info Section #}
                        <details class="mb-6 bg-blue-50 border border-blue-200 rounded-lg">
                            <summary class="cursor-pointer px-4 py-3 text-blue-900 font-semibold hover:bg-blue-100 rounded-lg transition-colors flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                About This Phase
                            </summary>
                            <div class="px-4 pb-4 pt-2 text-gray-700">
                                <p>Build wealth through regular contributions, employer matching, and compound interest during your working years. This is the foundation of your retirement plan where consistent saving and investment growth set you up for financial security.</p>
                            </div>
                        </details>

                        <form method="post"
                              hx-post="{% url 'calculator:calculate_accumulation' %}"
                              hx-target="#accumulation-results"
                              hx-indicator="#accumulation-loading"
                              hx-swap="innerHTML swap:0.3s settle:0.3s"
                              class="transition-all duration-300">
                            {% csrf_token %}

                            <div class="space-y-4">
                                {% for field in accumulation_form %}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ field.label }}
                                        {% if field.help_text %}
                                        <span class="text-xs text-gray-500 block">{{ field.help_text }}</span>
                                        {% endif %}
                                    </label>
                                    {{ field }}
                                </div>
                                {% endfor %}
                            </div>

                            <button type="submit" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
                                <span class="htmx-indicator" id="accumulation-loading">
                                    <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                    </svg>
                                </span>
                                <span class="htmx-indicator-opposite" id="accumulation-loading">Calculate Accumulation Phase</span>
                                <span class="htmx-indicator" id="accumulation-loading">Calculating...</span>
                            </button>
                        </form>
                    </div>

                    {# Results Column #}
                    <div id="accumulation-results" class="flex items-center justify-center text-gray-400 transition-all duration-500">
                        <div class="text-center animate-fade-in">
                            <svg class="w-24 h-24 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                            <p>Fill out the form and calculate to see your results</p>
                        </div>
                    </div>
                </div>
            </div>

            {# Phase 2: Phased Retirement #}
            <div id="content-phased-retirement" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {# Form Column #}
                    <div>
                        <h2 class="text-2xl font-bold text-purple-900 mb-4">Phase 2: Phased Retirement</h2>

                        {# Collapsible Info Section #}
                        <details class="mb-6 bg-purple-50 border border-purple-200 rounded-lg">
                            <summary class="cursor-pointer px-4 py-3 text-purple-900 font-semibold hover:bg-purple-100 rounded-lg transition-colors flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                About This Phase (Optional)
                            </summary>
                            <div class="px-4 pb-4 pt-2 text-gray-700">
                                <p>This is an <strong>optional</strong> transition period where you may work part-time while beginning to access retirement savings. This phase allows for a gradual shift from full-time work to complete retirement, providing both income and flexibility as you adjust to your new lifestyle.</p>
                            </div>
                        </details>

                        <form method="post"
                              hx-post="{% url 'calculator:calculate_phased_retirement' %}"
                              hx-target="#phased-retirement-results"
                              hx-indicator="#phased-retirement-loading">
                            {% csrf_token %}

                            <div class="space-y-4">
                                {# Starting Portfolio - custom ID for auto-population #}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ phased_retirement_form.starting_portfolio.label }}
                                        <span class="text-xs text-green-600 font-semibold" id="phase2-autopopulated" style="display:none;">
                                            âœ“ Auto-populated from Phase 1
                                        </span>
                                    </label>
                                    <input type="number"
                                           id="id_starting_portfolio_phase2"
                                           name="{{ phased_retirement_form.starting_portfolio.name }}"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                           step="0.01"
                                           placeholder="{{ phased_retirement_form.starting_portfolio.field.widget.attrs.placeholder|default:'60' }}">
                                </div>

                                {# Other fields #}
                                {% for field in phased_retirement_form %}
                                    {% if field.name != 'starting_portfolio' %}
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            {{ field.label }}
                                            {% if field.help_text %}
                                            <span class="text-xs text-gray-500 block">{{ field.help_text }}</span>
                                            {% endif %}
                                        </label>
                                        {{ field }}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <button type="submit" class="mt-6 w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
                                <span class="htmx-indicator" id="phased-retirement-loading">
                                    <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                    </svg>
                                </span>
                                <span class="htmx-indicator-opposite" id="phased-retirement-loading">Calculate Phased Retirement</span>
                                <span class="htmx-indicator" id="phased-retirement-loading">Calculating...</span>
                            </button>
                        </form>
                    </div>

                    {# Results Column #}
                    <div id="phased-retirement-results" class="flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <svg class="w-24 h-24 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                            <p>Fill out the form and calculate to see your results</p>
                        </div>
                    </div>
                </div>
            </div>

            {# Phase 3: Active Retirement #}
            <div id="content-active-retirement" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {# Form Column #}
                    <div>
                        <h2 class="text-2xl font-bold text-orange-900 mb-4">Phase 3: Active Retirement</h2>

                        {# Collapsible Info Section #}
                        <details class="mb-6 bg-orange-50 border border-orange-200 rounded-lg">
                            <summary class="cursor-pointer px-4 py-3 text-orange-900 font-semibold hover:bg-orange-100 rounded-lg transition-colors flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                About This Phase
                            </summary>
                            <div class="px-4 pb-4 pt-2 text-gray-700">
                                <p>Your early retirement years with an active lifestyle, travel opportunities, and moderate healthcare expenses. You're living on your retirement savings, Social Security, and any pension income while maintaining an engaged and fulfilling lifestyle.</p>
                            </div>
                        </details>

                        <form method="post"
                              hx-post="{% url 'calculator:calculate_active_retirement' %}"
                              hx-target="#active-retirement-results"
                              hx-indicator="#active-retirement-loading">
                            {% csrf_token %}

                            <div class="space-y-4">
                                {# Starting Portfolio - custom ID for auto-population #}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ active_retirement_form.starting_portfolio.label }}
                                        <span class="text-xs text-green-600 font-semibold" id="phase3-autopopulated" style="display:none;">
                                            âœ“ Auto-populated
                                        </span>
                                    </label>
                                    <input type="number"
                                           id="id_starting_portfolio_phase3"
                                           name="{{ active_retirement_form.starting_portfolio.name }}"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                           step="0.01"
                                           placeholder="{{ active_retirement_form.starting_portfolio.field.widget.attrs.placeholder|default:'65' }}">
                                </div>

                                {# Other fields #}
                                {% for field in active_retirement_form %}
                                    {% if field.name != 'starting_portfolio' %}
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            {{ field.label }}
                                            {% if field.help_text %}
                                            <span class="text-xs text-gray-500 block">{{ field.help_text }}</span>
                                            {% endif %}
                                        </label>
                                        {{ field }}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <button type="submit" class="mt-6 w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
                                <span class="htmx-indicator" id="active-retirement-loading">
                                    <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                    </svg>
                                </span>
                                <span class="htmx-indicator-opposite" id="active-retirement-loading">Calculate Active Retirement</span>
                                <span class="htmx-indicator" id="active-retirement-loading">Calculating...</span>
                            </button>
                        </form>
                    </div>

                    {# Results Column #}
                    <div id="active-retirement-results" class="flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <svg class="w-24 h-24 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                            <p>Fill out the form and calculate to see your results</p>
                        </div>
                    </div>
                </div>
            </div>

            {# Phase 4: Late Retirement #}
            <div id="content-late-retirement" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {# Form Column #}
                    <div>
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">Phase 4: Late Retirement & Legacy</h2>

                        {# Collapsible Info Section #}
                        <details class="mb-6 bg-indigo-50 border border-indigo-200 rounded-lg">
                            <summary class="cursor-pointer px-4 py-3 text-indigo-900 font-semibold hover:bg-indigo-100 rounded-lg transition-colors flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                About This Phase
                            </summary>
                            <div class="px-4 pb-4 pt-2 text-gray-700">
                                <p>Your final retirement years focusing on healthcare needs and legacy planning for beneficiaries. This phase accounts for increased medical costs and ensuring you can leave something for your loved ones.</p>
                            </div>
                        </details>

                        <form method="post"
                              hx-post="{% url 'calculator:calculate_late_retirement' %}"
                              hx-target="#late-retirement-results"
                              hx-indicator="#late-retirement-loading">
                            {% csrf_token %}

                            <div class="space-y-4">
                                {# Starting Portfolio - custom ID for auto-population #}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        {{ late_retirement_form.starting_portfolio.label }}
                                        <span class="text-xs text-green-600 font-semibold" id="phase4-autopopulated" style="display:none;">
                                            âœ“ Auto-populated
                                        </span>
                                    </label>
                                    <input type="number"
                                           id="id_starting_portfolio_phase4"
                                           name="{{ late_retirement_form.starting_portfolio.name }}"
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                           step="0.01"
                                           placeholder="{{ late_retirement_form.starting_portfolio.field.widget.attrs.placeholder|default:'80' }}">
                                </div>

                                {# Other fields #}
                                {% for field in late_retirement_form %}
                                    {% if field.name != 'starting_portfolio' %}
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            {{ field.label }}
                                            {% if field.help_text %}
                                            <span class="text-xs text-gray-500 block">{{ field.help_text }}</span>
                                            {% endif %}
                                        </label>
                                        {{ field }}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <button type="submit" class="mt-6 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
                                <span class="htmx-indicator" id="late-retirement-loading">
                                    <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                    </svg>
                                </span>
                                <span class="htmx-indicator-opposite" id="late-retirement-loading">Calculate Late Retirement</span>
                                <span class="htmx-indicator" id="late-retirement-loading">Calculating...</span>
                            </button>
                        </form>
                    </div>

                    {# Results Column #}
                    <div id="late-retirement-results" class="flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <svg class="w-24 h-24 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                            <p>Fill out the form and calculate to see your results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Save Scenario Section - After filling out the forms #}
        <div class="max-w-4xl mx-auto mt-8">
            <div id="save-message"></div>
            {% if user.is_authenticated %}
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ðŸ’¾ Save This Scenario</h2>
                    <p class="text-gray-600 mb-6">
                        Save your retirement plan to review or modify later. All your inputs across all phases will be saved.
                    </p>
                    <form id="save-scenario-form"
                          hx-post="{% url 'calculator:save_scenario' %}"
                          hx-target="#save-message"
                          hx-swap="innerHTML"
                          class="flex items-center gap-4">
                        {% csrf_token %}
                        <div class="flex-1">
                            <input type="text"
                                   name="name"
                                   placeholder="Enter scenario name (e.g., Conservative Retirement Plan)"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                                   required>
                        </div>
                        <button type="submit"
                                class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition font-semibold whitespace-nowrap">
                            Save Scenario
                        </button>
                    </form>
                </div>
            {% else %}
                <div class="bg-blue-50 border border-blue-200 rounded-lg shadow-lg p-8 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ðŸ’¾ Save This Scenario</h2>
                    <p class="text-gray-600 mb-6">
                        Want to save your retirement plan? Create a free account to save and compare multiple scenarios.
                    </p>
                    <div class="flex gap-4 justify-center">
                        <a href="{% url 'register' %}" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                            Create Account
                        </a>
                        <a href="{% url 'login' %}" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition font-semibold">
                            Login
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Custom fade-in animation for results */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-fade-in {
    animation: fadeIn 0.5s ease-out;
}

/* Collapsible details styling */
details summary {
    list-style: none;
}

details summary::-webkit-details-marker {
    display: none;
}

details summary::before {
    content: 'â–¶';
    display: inline-block;
    margin-right: 0.5rem;
    transition: transform 0.2s ease;
    font-size: 0.75rem;
}

details[open] summary::before {
    transform: rotate(90deg);
}

details[open] summary {
    border-bottom: 1px solid currentColor;
    border-bottom-opacity: 0.2;
    margin-bottom: 0.5rem;
}

/* HTMX swap animations */
.htmx-swapping {
    opacity: 0;
    transition: opacity 0.3s ease-out;
}

.htmx-settling {
    opacity: 1;
    transition: opacity 0.3s ease-in;
}

/* Tab transition animation */
.tab-content {
    animation: fadeIn 0.4s ease-out;
}

/* Button hover effects */
.tab-button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Form input focus animations */
input:focus, select:focus, textarea:focus {
    transform: scale(1.01);
    transition: transform 0.2s ease-out;
}
</style>

<script>
function switchTab(phase) {
    // Hide all tab contents with fade effect
    document.querySelectorAll('.tab-content').forEach(content => {
        content.style.opacity = '0';
        setTimeout(() => {
            content.classList.add('hidden');
        }, 200);
    });

    // Reset all tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('border-blue-500', 'border-purple-500', 'border-orange-500', 'border-indigo-500');
        button.classList.remove('bg-blue-50', 'bg-purple-50', 'bg-orange-50', 'bg-indigo-50');
        button.classList.remove('text-blue-700', 'text-purple-700', 'text-orange-700', 'text-indigo-700');
        button.classList.add('border-transparent', 'text-gray-600');
    });

    // Show selected tab content with fade-in
    setTimeout(() => {
        const content = document.getElementById('content-' + phase);
        content.classList.remove('hidden');
        content.style.opacity = '0';
        setTimeout(() => {
            content.style.opacity = '1';
        }, 50);
    }, 200);

    // Highlight selected tab button
    const activeButton = document.getElementById('tab-' + phase);
    activeButton.classList.remove('border-transparent', 'text-gray-600');

    if (phase === 'accumulation') {
        activeButton.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-700');
    } else if (phase === 'phased-retirement') {
        activeButton.classList.add('border-purple-500', 'bg-purple-50', 'text-purple-700');
    } else if (phase === 'active-retirement') {
        activeButton.classList.add('border-orange-500', 'bg-orange-50', 'text-orange-700');
    } else if (phase === 'late-retirement') {
        activeButton.classList.add('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
    }
}

// Add smooth scroll behavior
document.addEventListener('DOMContentLoaded', function() {
    document.documentElement.style.scrollBehavior = 'smooth';
});

// Capture all form data when saving scenario
document.getElementById('save-scenario-form').addEventListener('htmx:configRequest', function(event) {
    // Get all input, select, and textarea elements from all phase forms
    const allInputs = document.querySelectorAll('#content-accumulation input, #content-accumulation select, ' +
                                                 '#content-phased-retirement input, #content-phased-retirement select, ' +
                                                 '#content-active-retirement input, #content-active-retirement select, ' +
                                                 '#content-late-retirement input, #content-late-retirement select');

    // Add each input value to the request
    allInputs.forEach(input => {
        if (input.name && input.value) {
            event.detail.parameters[input.name] = input.value;
        }
    });
});
</script>
{% endblock %}
